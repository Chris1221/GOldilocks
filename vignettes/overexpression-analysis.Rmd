---
title: "Overexpression of Terms in a Target Set of Abstracts"
author: "Christopher B. Cole"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Overexpression of Terms in a Target Set of Abstracts}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

In this analysis we seek to find Gene Ontology terms which may be overrepresented in a "target set" of abstracts, such as the results of a PubMed query.

We first fetch all the results of a specific query from Pubmed using the `RISmed` package and store their abstracts in a `data.frame`.

```{R}
library(RISmed)

# Store the input string for reuse
search_topic <- "anaphylaxis genetics"
search_query <- EUtilsSummary(search_topic, mindate=2014, maxdate=2015)

summary(search_query)

pull <- EUtilsGet(search_query)

data <- data.frame('Abstracts' = AbstractText(pull))

# Get rid of first entry for some reason, seems to always be blank
data[,1] <- as.character(data[,1])
data <- data[-1,]

head(data)
```

We want to compare the terms found here to something, so we grab all abstracts from 2014 to 2015 which match a similar field, i.e. immunology genetics.  Note that only 1000 records are taken by default.

```{R}
# Store the input string for reuse
search_topic <- "immunology genetics"
search_query <- EUtilsSummary(search_topic, # Find all articles matching the string
                              mindate=2014, # From 2014
                              maxdate=2015, # to 2015
                              retmax = 1000)  # This is the default but explicit

summary(search_query)

pull_control <- EUtilsGet(search_query)

control <- data.frame('Abstracts' = AbstractText(pull_control))

# Get rid of first entry for some reason, seems to always be blank
control[,1] <- as.character(control[,1])
control <- control[-1,]

head(control)
```

We now run `mineR` on each of the entries in both the target group and the control group.

```{R}
library(mineR)

terms <- system.file("extdata/MF_terms", package = "mineR")

for(i in 1:nrow(data)){
  mineR(doc = data[i], 
        terms = terms, 
        local = F, 
        lims = as.list(c(1,2,3,4,4,5,6,7,7,8,10)),
        syn = F,
        length = 10,
        return.as.list = T,
        log = "/dev/null",
        pdf_read = "local",
        output = "/dev/null")
}